# 🔧 Google Apps Script 权限修复指南

## 问题说明
出现 **403 Forbidden** 错误，说明Google Apps Script的访问权限设置不正确。

## 🚨 错误信息
```
script.googleusercontent.com/macros/echo?user_content_key=... Failed to load resource: the server responded with a status of 403 ()
```

## ✅ 解决步骤

### 步骤1：检查部署设置
1. 打开您的Google Apps Script：https://script.google.com
2. 找到您的项目并打开
3. 点击右上角的 **"部署"** 按钮
4. 选择 **"管理部署"**

### 步骤2：修复权限设置
在部署设置中确认以下配置：

#### ✅ 必须设置：
- **类型**：Web 应用
- **执行身份**：我
- **有权访问的用户**：**任何人** ⚠️ 这是关键！

#### ❌ 常见错误设置：
- ~~有权访问的用户：仅我自己~~
- ~~有权访问的用户：组织内的任何人~~

### 步骤3：重新部署
1. 如果设置不正确，点击 ✏️ **"编辑"**
2. 将 **"有权访问的用户"** 改为 **"任何人"**
3. 点击 **"部署"**
4. 复制新的部署URL

### 步骤4：更新代码中的URL
如果获得了新的URL，需要更新所有文件中的Google Apps Script URL。

## 🔍 详细检查清单

### ✅ Apps Script 设置检查
- [ ] 项目已保存
- [ ] 代码无语法错误
- [ ] 已授权必要的权限（Google Sheets访问）
- [ ] 部署类型为"Web 应用"
- [ ] 执行身份为"我"
- [ ] **访问权限为"任何人"** ⚠️

### ✅ Google Sheet 检查
- [ ] Google Sheet存在且可访问
- [ ] 您对该Sheet有编辑权限
- [ ] Sheet没有被删除或移动

## 🛠 权限授权步骤

### 首次部署时：
1. 点击"部署"时会提示需要授权
2. 点击 **"授权访问"**
3. 选择您的Google账户
4. 点击 **"高级"**（如果显示不安全警告）
5. 点击 **"转至 [项目名称]（不安全）"**
6. 点击 **"允许"**

### 如果出现权限问题：
1. 在Apps Script中点击左侧的 **"权限"**
2. 确认已授权 Google Sheets API
3. 如有问题，点击 **"重新授权"**

## 🧪 测试验证

### 方法1：直接访问URL
在浏览器中直接访问您的Apps Script URL：
```
https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec
```
- ✅ 正常：显示JSON数据或执行结果
- ❌ 错误：显示403或其他错误

### 方法2：使用测试页面
访问：https://nice554.github.io/shou/test-connection.html
- 点击"测试连接"
- 查看结果

## 🔄 完整重新部署流程

如果以上步骤都不行，建议完整重新部署：

1. **删除现有部署**
   - 部署 → 管理部署 → 删除

2. **创建新部署**
   - 部署 → 新部署
   - 类型：Web 应用
   - 执行身份：我
   - 访问权限：**任何人**
   - 点击"部署"

3. **复制新URL**
   - 复制生成的Web应用URL

4. **更新所有文件**
   - 将新URL更新到所有HTML文件中

## ❓ 仍有问题？

请提供以下信息：
1. Google Apps Script的部署设置截图
2. 直接访问Apps Script URL的结果
3. 您的Google账户类型（个人/企业）
4. 浏览器控制台的完整错误信息

## 📞 快速检查
**最关键的设置**：确保部署时选择了 **"任何人"** 访问权限！这是最常见的问题原因。