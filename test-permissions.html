<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æƒé™æµ‹è¯•</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            line-height: 1.6;
        }
        button { 
            padding: 10px 20px; 
            margin: 10px 0; 
            font-size: 16px;
            display: block;
            width: 100%;
        }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        #log { 
            background: #f5f5f5; 
            padding: 10px; 
            margin: 20px 0;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <h1>ğŸ“± æ–‡ä»¶æƒé™æµ‹è¯•</h1>
    
    <button onclick="testEnvironment()">ğŸ” æ£€æµ‹ç¯å¢ƒ</button>
    <button onclick="requestPermissions()">ğŸ” è¯·æ±‚æƒé™</button>
    <button onclick="testSaveToDownloads()">ğŸ“¥ æµ‹è¯•ä¿å­˜åˆ°ä¸‹è½½æ–‡ä»¶å¤¹</button>
    <button onclick="testSaveToDocuments()">ğŸ“„ æµ‹è¯•ä¿å­˜åˆ°æ–‡æ¡£æ–‡ä»¶å¤¹</button>
    <button onclick="openFileManager()">ğŸ—‚ï¸ æ‰“å¼€æ–‡ä»¶ç®¡ç†å™¨</button>
    <button onclick="openAppFolder()">ğŸ“ æ‰“å¼€åº”ç”¨æ–‡ä»¶å¤¹</button>
    <button onclick="clearLog()">ğŸ§¹ æ¸…é™¤æ—¥å¿—</button>
    
    <div id="log"></div>

    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            logDiv.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        function testEnvironment() {
            log('ğŸ” å¼€å§‹ç¯å¢ƒæ£€æµ‹...');
            
            // æ£€æµ‹å¹³å°
            log(`ğŸ“± ç”¨æˆ·ä»£ç†: ${navigator.userAgent}`);
            log(`ğŸŒ å¹³å°: ${navigator.platform}`);
            
            // æ£€æµ‹ Capacitor
            if (window.Capacitor) {
                log('âœ… Capacitor å¯ç”¨', 'success');
                log(`ğŸ“¦ Capacitor å¹³å°: ${window.Capacitor.getPlatform()}`);
                
                if (window.Capacitor.Plugins.FileManager) {
                    log('âœ… FileManager æ’ä»¶å¯ç”¨', 'success');
                } else {
                    log('âŒ FileManager æ’ä»¶ä¸å¯ç”¨', 'error');
                }
            } else {
                log('âŒ Capacitor ä¸å¯ç”¨', 'error');
            }
            
            // æ£€æµ‹ Web API
            if (typeof Blob !== 'undefined') {
                log('âœ… Blob API æ”¯æŒ', 'success');
            } else {
                log('âŒ Blob API ä¸æ”¯æŒ', 'error');
            }
            
            if (typeof URL !== 'undefined' && URL.createObjectURL) {
                log('âœ… URL.createObjectURL æ”¯æŒ', 'success');
            } else {
                log('âŒ URL.createObjectURL ä¸æ”¯æŒ', 'error');
            }
        }

        async function requestPermissions() {
            if (!window.Capacitor || !window.Capacitor.Plugins.FileManager) {
                log('âŒ FileManager æ’ä»¶ä¸å¯ç”¨', 'error');
                return;
            }

            try {
                log('ğŸ” è¯·æ±‚æ–‡ä»¶æƒé™...');
                const result = await window.Capacitor.Plugins.FileManager.requestPermissions();
                log(`âœ… æƒé™è¯·æ±‚ç»“æœ: ${JSON.stringify(result)}`, 'success');
            } catch (error) {
                log(`âŒ æƒé™è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function testSaveToDownloads() {
            if (!window.Capacitor || !window.Capacitor.Plugins.FileManager) {
                log('âŒ FileManager æ’ä»¶ä¸å¯ç”¨', 'error');
                return;
            }

            const testContent = `æµ‹è¯•æ–‡ä»¶å†…å®¹
æ—¶é—´: ${new Date().toLocaleString()}
å¹³å°: ${navigator.platform}
ç”¨æˆ·ä»£ç†: ${navigator.userAgent}

è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶ï¼Œç”¨äºéªŒè¯æ–‡ä»¶ä¿å­˜åŠŸèƒ½ã€‚`;

            const filename = `test_${Date.now()}.txt`;

            try {
                log(`ğŸ“¥ ä¿å­˜æµ‹è¯•æ–‡ä»¶åˆ°ä¸‹è½½æ–‡ä»¶å¤¹: ${filename}`);
                const result = await window.Capacitor.Plugins.FileManager.saveFileToDownloads({
                    filename: filename,
                    content: testContent
                });
                log(`âœ… ä¿å­˜æˆåŠŸ: ${JSON.stringify(result)}`, 'success');
            } catch (error) {
                log(`âŒ ä¿å­˜å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function testSaveToDocuments() {
            if (!window.Capacitor || !window.Capacitor.Plugins.FileManager) {
                log('âŒ FileManager æ’ä»¶ä¸å¯ç”¨', 'error');
                return;
            }

            const testContent = `æ–‡æ¡£æµ‹è¯•æ–‡ä»¶
åˆ›å»ºæ—¶é—´: ${new Date().toLocaleString()}
è®¾å¤‡ä¿¡æ¯: ${navigator.userAgent}

è¿™æ˜¯ä¿å­˜åˆ°æ–‡æ¡£æ–‡ä»¶å¤¹çš„æµ‹è¯•æ–‡ä»¶ã€‚`;

            const filename = `document_test_${Date.now()}.txt`;

            try {
                log(`ğŸ“„ ä¿å­˜æµ‹è¯•æ–‡ä»¶åˆ°æ–‡æ¡£æ–‡ä»¶å¤¹: ${filename}`);
                const result = await window.Capacitor.Plugins.FileManager.saveFileToDocuments({
                    filename: filename,
                    content: testContent
                });
                log(`âœ… ä¿å­˜æˆåŠŸ: ${JSON.stringify(result)}`, 'success');
            } catch (error) {
                log(`âŒ ä¿å­˜å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function openFileManager() {
            if (!window.Capacitor || !window.Capacitor.Plugins.FileManager) {
                log('âŒ FileManager æ’ä»¶ä¸å¯ç”¨', 'error');
                return;
            }

            try {
                log('ğŸ—‚ï¸ æ‰“å¼€æ–‡ä»¶ç®¡ç†å™¨...');
                const result = await window.Capacitor.Plugins.FileManager.openFileManager();
                log(`âœ… æ–‡ä»¶ç®¡ç†å™¨æ‰“å¼€æˆåŠŸ: ${JSON.stringify(result)}`, 'success');
            } catch (error) {
                log(`âŒ æ‰“å¼€æ–‡ä»¶ç®¡ç†å™¨å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function openAppFolder() {
            if (!window.Capacitor || !window.Capacitor.Plugins.FileManager) {
                log('âŒ FileManager æ’ä»¶ä¸å¯ç”¨', 'error');
                return;
            }

            try {
                log('ğŸ“ æ‰“å¼€å¿«é€’æ‰«ç åŠ©æ‰‹ä¸“ç”¨æ–‡ä»¶å¤¹...');
                const result = await window.Capacitor.Plugins.FileManager.openAppFolder();
                log(`âœ… åº”ç”¨æ–‡ä»¶å¤¹æ‰“å¼€æˆåŠŸ: ${JSON.stringify(result)}`, 'success');
            } catch (error) {
                log(`âŒ æ‰“å¼€åº”ç”¨æ–‡ä»¶å¤¹å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æµ‹ç¯å¢ƒ
        window.onload = function() {
            log('ğŸš€ æƒé™æµ‹è¯•é¡µé¢å·²åŠ è½½');
            setTimeout(testEnvironment, 1000);
        };
    </script>
</body>
</html>